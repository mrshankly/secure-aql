{cover_enabled, true}.

{erl_opts, [
    debug_info,
    warnings_as_errors,
    {i, "./_build/default/plugins/gpb/include/"}
]}.

{edoc_opts, [
    {preprocess, true},
    {todo, true},
    {includes, ["include/"]},
    {dir, "edoc"}
]}.

{deps, [
    {antidote,
        {git, "https://github.com/mrshankly/antidote.git",
            {branch, "aql-tests"}}},
    {ranch, "2.0.0"},
    {elli, "3.0.0"},
    {jsx, "2.9.0"}
]}.

{relx, [
    {release, {aql, "0.0.1"}, [aql]},
    {dev_mode, false},
    {include_erts, true},

    {sys_config, "config/sys.config"},
    {vm_args, "config/vm.args"},

    {overlay, [
        {mkdir, "data/ring"},
        {mkdir, "log/sasl"},
        {copy, "bin/env", "bin/env"},
        {template, "_build/default/lib/antidote/rel/files/antidote-admin", "bin/antidote-admin"},
        {template, "_build/default/lib/cuttlefish/priv/erlang_vm.schema",
            "lib/11-erlang_vm.schema"},
        {template, "_build/default/lib/riak_core/priv/riak_core.schema",
            "lib/12-riak_core.schema"},
        {template, "_build/default/lib/riak_sysmon/priv/riak_sysmon.schema",
            "lib/15-riak_sysmon.schema"},
        {template, "_build/default/lib/eleveldb/priv/eleveldb.schema", "lib/21-leveldb.schema"}
    ]},
    {overlay_vars, "config/vars.config"},
    {extended_start_script, true}
]}.

{plugins, [
    erlfmt,
    {rebar3_gpb_plugin, "2.10.0"}
]}.

{erlfmt, [
    write,
    {print_width, 99},
    {files, ["{src,include,test}/*.{hrl,erl,app.src}", "rebar.config"]}
]}.

{gpb_opts, [
    {i, "proto"},
    {module_name_suffix, "_pb"},
    {o_erl, "src"},
    {o_hrl, "include"},
    {strings_as_binaries, true},
    type_specs
]}.

{provider_hooks, [
    {pre, [
        {clean, {protobuf, clean}},
        {compile, {protobuf, compile}}
    ]}
]}.
